---
controller_execution_environments:
  - name: VMWare EE / Community
    image: quay.io/matferna/vmware_ee
  - name: Product-demos Updated
    image: quay.io/matferna/pd-updated
  - name: VMWare EE / REST
    image: quay.io/matferna/vmware_rest

controller_credential_types:
  - name: Windows Password Injector
    kind: cloud
    inputs:
      fields:
        - id: windows_password
          type: string
          label: Windows Password
          secret: true
    injectors:
      env:
        WIN_PASSWORD: !unsafe '{{ windows_password }}'

controller_credentials:
  - name: VMWare vCenter Credential
    credential_type: VMware vCenter
    organization: Default
    inputs:
      host: REPLACEME
      username: REPLACEME
      password: REPLACEME

  - name: Windows Administrator Password
    credential_type: Windows Password Injector
    organization: Default
    inputs:
      windows_password: REPLACEME

  - name: Windows machine credential
    credential_type: Machine
    organization: Default
    inputs:
      username: REPLACEME
      password: REPLACEME

controller_inventory_sources:
  - name: VMWare vCenter Inventory
    inventory: Demo Inventory
    source: vmware
    source_vars:
      hostnames:
        - config.name
    credential: VMWare vCenter Credential
    execution_environment: VMWare EE / Community

controller_groups:
  - name: windows2019srv_64Guest
    description: group for windows
    inventory: Demo Inventory
    variables:
      ansible_connection: winrm
      ansible_winrm_port: 5985
      ansible_winrm_server_cert_validation: ignore
      ansible_winrm_transport: ntlm

controller_templates:
  - name: "WINDOWS / Install MS SQL"
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "vmware/install_sqlserver.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    execution_environment: Product-demos Updated
    credentials:
      - "Windows machine credential"
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: Server Name or Pattern
          type: text
          variable: _hosts
          required: false

  - name: "VMWARE / Provision Windows VM"
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "vmware/provision_vm.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    execution_environment: VMWare EE / Community
    credentials:
      - "VMWare vCenter Credential"
      - "Windows Administrator Password"
    extra_vars:
      vmware_dns_servers: 10.11.5.19
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: VM Name
          type: text
          variable: vm_name
          required: true
        - question_name: Select tempalte
          type: multiplechoice
          variable: vm_template
          choices:
            - msws19_clt
            - msw10
          required: true
        - question_name: Choose Folder
          type: multiplechoice
          variable: vm_folder
          choices:
            - /Datacenter/vm/matferna
            - /Datacenter/vm/sdunne
            - /Datacenter/vm/wlupton
          required: true
        - question_name: Select network
          type: multiplechoice
          variable: vm_network
          choices:
            - DSwitch-VM Network
            - airgap-VLAN999
          required: true

  - name: "VMWARE / Delete VM"
    job_type: run
    inventory: "Demo Inventory"
    project: "Ansible official demo project"
    playbook: "vmware/delete_vm.yml"
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    execution_environment: VMWare EE / Community
    credentials:
      - "VMWare vCenter Credential"
    survey_enabled: true
    survey:
      name: ''
      description: ''
      spec:
        - question_name: VM Name
          type: text
          variable: vm_name
          required: true

controller_workflows:
  - name: VMWARE / Windows / Provision SQL Server
    description: A workflow to provision new vCenter Windows VM with SQL Server deployed and configured.
    organization: Default
    notification_templates_started: Telemetry
    notification_templates_success: Telemetry
    notification_templates_error: Telemetry
    simplified_workflow_nodes:
      - identifier: Provision VM
        unified_job_template: VMWARE / Provision Windows VM
        extra_data:
          vm_template: msws19_clt
          vm_network: DSwitch-VM Network
          vm_folder: /Datacenter/vm/matferna
          vm_name: sqlserver
        failure_nodes:
          - Delete VM
        success_nodes:
          - Inventory Sync
      - identifier: Delete VM
        unified_job_template: VMWARE / Delete VM
        extra_data:
          vm_name: sqlserver
      - identifier: Inventory Sync
        unified_job_template: VMWare vCenter Inventory
        success_nodes:
          - Install SSMS
      - identifier: Install SSMS
        unified_job_template: WINDOWS / Install SSMS
        extra_data:
          _hosts: sqlserver
        failure_nodes:
          - Ticket - Provision Failed
      - identifier: Ticket - Provision Failed
        unified_job_template: 'SUBMIT FEEDBACK'
        extra_data:
          feedback: VMWARE / Windows/ Provision SQL Server  | Failed to provision SQL Server
          email: youremail@mail.com
